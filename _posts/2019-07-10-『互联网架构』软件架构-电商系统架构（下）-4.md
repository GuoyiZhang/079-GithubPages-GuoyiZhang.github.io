# 『互联网架构』软件架构-电商系统架构（下）-4

上节从jenkins 和 nexus3 私服做了关联，通过github开放的一个源码，完成了从maven的构建到打包的过程，并上传到私服的私有仓库中。192.168.72.104完成了tomcat的简单下载和运行。这次主要自动化集成通过shell的方式完成从nexus3下载j私有仓库的war，部署到tomcat中。jenkins+nexus3+gogs+tomcat搭建这套环境真心比较麻烦，但是理解了其实不难，搭建后还是一直可以受益的。重点还是需要实践。源码：

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1mOTYxODk0ODM4MmQ3NzIyLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

### （一）tomcat的持续部署设置

* 准备工作
之前我演示是用的springboot的开源项目，进行部署的，这次在github随便找个开源生成war包的项目进行部署。有2个地方需要进行修改。

1.地址更换（实际开发的使用用gogs上面的）

[https://github.com/Zoutao6/examination_system-.git](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FZoutao6%2Fexamination_system-.git)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS0wYmQwZmE0ZGZkMGQ2M2I1LnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

2.nexus获取上传war包的地址（192.168.73.103）

 

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1mNGE4YWI4NWJhMzY0NDdhLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS04MTliOGI0MjMxNDc2ZjIxLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1jZTEzNTQwZTgzZGI2ZTYwLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1kMjZlMmI5NWIwMjg1YmVlLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)
[http://192.168.72.103:8081/service/rest/repository/browse/3rd_part/com/test/example/1.0.0/](https://links.jianshu.com/go?to=http%3A%2F%2F192.168.72.103%3A8081%2Fservice%2Frest%2Frepository%2Fbrowse%2F3rd_part%2Fcom%2Ftest%2Fexample%2F1.0.0%2F)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1kYTQ1YmE3MGU2OWJkZDY5LnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS0yYWExMTdiY2E4MmI3Mjk2LnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)
[http://192.168.72.103:8081/repository/3rd_part/com/test/example/1.0.0/example-1.0.0.war](https://links.jianshu.com/go?to=http%3A%2F%2F192.168.72.103%3A8081%2Frepository%2F3rd_part%2Fcom%2Ftest%2Fexample%2F1.0.0%2Fexample-1.0.0.war)

2.构建后的shell改变（192.168.73.102）

/# Dpackaging 修改成 war /# Dfile 修改成上面获取到的/root/.jenkins/workspace/abc-test2/target/Examination_System.war mvn deploy:deploy-file -DgroupId=com.test -DartifactId=example -Dversion=1.0.0 -Dpackaging=war -Dfile=/root/.jenkins/workspace/abc-test2/target/Examination_System.war -Durl=http://192.168.72.103:8081/repository/3rd_part/ -DrepositoryId=nexus

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS0zNzFmYmVlNjhiOTAwYjRhLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

3.编写原来的apche-tomcat制作软连接（192.168.73.104）
cd ~ ln -s jdk1.8.0_141/ jdk ln -s apache-tomcat-7.0.94/ tomcat

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS0wYTc1MzI1ZDA1YzEwM2YzLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

4.创建services文件夹，放入脚本
/#创建service群，里面可以放很多个tomcat mkdir services cd services /#文件上传插件 yum -y install lrzsz cp -r /root/tomcat/ /root/services/shop-project/ cd /root/services/shop-project/ rm -rf apache-tomcat-7.0.92/ bin BUILDING.txt CONTRIBUTING.md LICENSE NOTICE README.md RELEASE-NOTES RUNNING.txt /# env-set.sh上传bin目录跟shop-project 同级 cd /root/service/bin rz /# deploy.sh jenkins.sh pom.sh tomcat.sh /# 上传到shop-project目录内

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS0wYTI0ZGZhYWM3N2I1YmFiLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS03MzFkZmZlMGJlMDg4NGU4LnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvNjI0L2Zvcm1hdC93ZWJw?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1lODYxYmRmMDY3ZDdkOTI0LnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

4.命令操作
/#查看目录文件 ll /#这个文件夹的名称目前是shop-project，可以自行修改 cd shop-project /#针对解压后的脚本增加访问的权限 chmod -R 777 /* cd .. cd bin chmod -R 777 /*

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS01OWY5MDkyZDkyN2QzZWRjLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1jNDhjOTJhZTBhNGI3NjZkLnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvOTMxL2Zvcm1hdC93ZWJw?x-oss-process=image/format,png)

image.png

5.从nexus私服中下载war，启动项目
./jenkins.sh

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS05MWZkOTJkZWYwOTJiZTc3LnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvMTAwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png)

6.关闭本项目的tomcat
./tomcat.sh stop

![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xMTIyMzcxNS1kZTVhOTNjNmJkYmNlOTM4LnBuZz9pbWFnZU1vZ3IyL2F1dG8tb3JpZW50L3N0cmlwJTdDaW1hZ2VWaWV3Mi8yL3cvOTM4L2Zvcm1hdC93ZWJw?x-oss-process=image/format,png)

7.app-conf
目录主要是为了，在本地环境和服务器环境密码不同，每次下载后，替换里面的配置文件，每次如果开发修改了配置文件，服务器环境也需要对应的修改。

8.shop-project

只是个文件夹名称，可以根据自己的需求来进行修改。

### （二）总结

三个关联的文章完成了。
1.gogs的部署，jenkins的部署，nexus的部署。
2.jenkins和nexus之前的关联，通过连接github下载源码，然后讲源码进行打包上传到nexus的指定仓库中。
3.tomcat通过shell脚本的方式下载nexus中的war包。可选择的app-conf替换成服务器的配置文件，shell这块我注释了，可以选择的进行使用。
4.pom.sh 主要是根据配置的方式来下载。
5.新建立的shop-project文件夹都依赖通一个tomcat和jdk，这样方面使用，如果tomcat和jdk更换，只需要删除软连接新建立软连接就可以了。
6.多个项目的话，可以重复的shop-project文件夹，修改文件夹内部的tomcat的conf文件修改端口号，修改里面的pom.sh文件。
7.这套部署方式很方便，一劳永逸。据说唯品会的一些项目都是这样的。

PS：电商系统的集成环境彻底搭建完毕，陆陆续续从虚拟机的搭建，到一个一个服务的部署，服务之前的关联耗时3天时间，总算完成了，下一步咱们继续电商系统的学习。


